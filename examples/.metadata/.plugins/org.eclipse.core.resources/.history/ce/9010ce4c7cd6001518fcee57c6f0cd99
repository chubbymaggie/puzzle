package simple.constraints

import fr.inria.diverse.k3.al.annotationprocessor.Aspect
import fr.inria.diverse.k3.al.annotationprocessor.OverrideAspectMethod

import java.util.Hashtable	

import simpleconstraintslanguage.RelationalConstraint
import simpleconstraintslanguage.RelationalOperator
import simpleconstraintslanguage.Constraint

@Aspect(className=Constraint)
abstract class ConstraintAspect{
	def public boolean evalConstraint(Hashtable<String,Object> context)
}

@Aspect(className=RelationalConstraint)
class RelationalConstraintAspect extends ConstraintAspect{
	
	@OverrideAspectMethod
	def public boolean evalConstraint(Hashtable<String,Object> context){
		if(_self.operator == RelationalOperator.EQUAL){
			return (_self.left.obtainValue(context) as Integer).intValue == (_self.right.obtainValue(context) as Integer).intValue 
		}else if(_self.operator == CRelationalOperator.NOT_EQUAL){
			return (_self.left.obtainValue(context) as Integer).intValue != (_self.right.obtainValue(context) as Integer).intValue
		}else if(_self.operator == CRelationalOperator.LESS_THAN){
			return (_self.left.obtainValue(context) as Integer).intValue < (_self.right.obtainValue(context) as Integer).intValue
		}else if(_self.operator == CRelationalOperator.GREATER_THAN){
			return (_self.left.obtainValue(context) as Integer).intValue > (_self.right.obtainValue(context) as Integer).intValue
		}else {
			return false;	
		}
	}
}