package fr.inria.diverse.puzzle.vmsynthesis.impl;

import java.util.ArrayList;

import vm.PBooleanExpression;
import vm.PFeatureRef;
import vm.PUnaryExpression;

public class RightImplicationsGroup {

	// -----------------------------------------------
	// Attributes
	// -----------------------------------------------
	
	private PBooleanExpression rightSide;
	
	private ArrayList<PFeatureRef> leftSide;
	
	// -----------------------------------------------
	// Constructors
	// -----------------------------------------------
	
	public RightImplicationsGroup(PFeatureRef rightSide){
		this.rightSide = rightSide;
		this.leftSide = new ArrayList<PFeatureRef>();
	}

	// -----------------------------------------------
	// Getters and setters
	// -----------------------------------------------
	
	public PBooleanExpression getRightSide() {
		return rightSide;
	}

	public void setRightSide(PBooleanExpression rightSide) {
		this.rightSide = rightSide;
	}

	public ArrayList<PFeatureRef> getLeftSide() {
		return leftSide;
	}
	
	// -----------------------------------------------
	// Methods
	// -----------------------------------------------
	
	public String toString(){
		String leftSide = "";
		boolean first = true;
		for (PFeatureRef pFeatureRef : this.leftSide) {
			if(!first)
				leftSide += " and";
			
			leftSide += " " + pFeatureRef.getRef().getName();
			first = false;
		}
		if(rightSide instanceof PFeatureRef)
			return "(" + leftSide + " ) implies " + ((PFeatureRef)rightSide).getRef().getName();
		else
			return "(" + leftSide + " ) implies " + ((PUnaryExpression)rightSide).getExpr().getName();
	}
	
	public boolean equals(Object o){
		RightImplicationsGroup group = (RightImplicationsGroup) o;
		boolean rightSideEqual = this.rightSide.getRef().getName().
				equals(group.rightSide.getRef().getName());
		boolean leftSideEqual = true;
		for (PFeatureRef pFeatureRef : leftSide) {
			if(!this.containsFeature(group.getLeftSide(), pFeatureRef)){
				leftSideEqual = false;
				break;
			}
		}
		return rightSideEqual && leftSideEqual && group.getLeftSide().size() == this.leftSide.size();
	}

	private boolean containsFeature(ArrayList<PFeatureRef> leftSide2,
			PFeatureRef pFeatureRef) {
		for (PFeatureRef feature : leftSide2) {
			if(feature.getRef().getName().equals(pFeatureRef.getRef().getName()))
				return true;
		}
		return false;
	}
}
